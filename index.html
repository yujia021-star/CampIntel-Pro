<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CampGuard Expert v9.1</title>
    <style>
        :root { --bg: #0b0f1a; --accent: #00d4ff; --card: rgba(23, 32, 53, 0.95); --text: #e0e6ed; --danger: #ff4d4d; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; }
        .container { max-width: 480px; margin: 0 auto; }
        .main-card { background: var(--card); border-radius: 28px; padding: 25px; border: 1px solid rgba(255,255,255,0.1); text-align: center; margin-bottom: 20px; }
        .score { font-size: 5rem; font-weight: 900; line-height: 1; margin: 15px 0; }
        .ai-recommend { background: rgba(0, 212, 255, 0.1); border-left: 4px solid var(--accent); padding: 15px; border-radius: 12px; text-align: left; font-size: 0.9rem; line-height: 1.5; }
        .insight-card { background: var(--card); border-radius: 20px; padding: 20px; border: 1px solid rgba(255,255,255,0.1); }
        .insight-item { border-bottom: 1px solid rgba(255,255,255,0.05); padding: 12px 0; font-size: 0.85rem; }
        .badge { display: inline-block; padding: 2px 8px; border-radius: 6px; font-size: 0.7rem; font-weight: bold; margin-bottom: 5px; background: var(--accent); color: var(--bg); }
        .badge-5 { background: var(--danger); color: white; }
        
        .search-row { display: flex; gap: 8px; margin-bottom: 20px; }
        input { flex: 1; padding: 15px; border-radius: 12px; border: 1px solid #334155; background: #1a2236; color: white; outline: none; }
        button { background: var(--accent); color: var(--bg); border: none; padding: 0 25px; border-radius: 12px; font-weight: 800; cursor: pointer; }
        
        .loading { position: fixed; inset: 0; background: rgba(0,0,0,0.8); display: none; align-items: center; justify-content: center; z-index: 100; font-weight: bold; }
    </style>
</head>
<body>

<div id="loader" class="loading">ğŸ§  ãƒ“ãƒƒã‚°ãƒ‡ãƒ¼ã‚¿ç…§åˆä¸­...</div>

<div class="container">
    <h2 style="text-align:center; letter-spacing: 2px;">CAMPGUARD <span style="color:var(--accent)">EXPERT</span></h2>

    <div class="search-row">
        <input type="text" id="locInput" placeholder="ã‚­ãƒ£ãƒ³ãƒ—å ´åã¾ãŸã¯åœ°å" value="å–œå¤šæ–¹å¸‚">
        <button onclick="diagnose()">è¨ºæ–­</button>
    </div>

    <div class="main-card">
        <div style="font-size: 0.8rem; font-weight: bold; color: var(--accent);">RISK SCORE</div>
        <div id="scoreVal" class="score">--</div>
        
        <div id="recArea" class="ai-recommend" style="display:none;">
            <div style="font-size: 0.7rem; color: var(--accent); font-weight: bold; margin-bottom: 5px;">AI ADVICE</div>
            <div id="recText"></div>
        </div>
    </div>

    <div id="insightCard" class="insight-card" style="display:none;">
        <div style="font-weight: bold; color: var(--accent); margin-bottom: 15px;">ğŸ“š éå»ã®é‡è¦çŸ¥è¦‹</div>
        <div id="insightList"></div>
    </div>
</div>

<script>
    const gasUrl = "â˜…ã“ã“ã«ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®URLã‚’è²¼ã‚‹â˜…";

    async function diagnose() {
        document.getElementById('loader').style.display = 'flex';
        const loc = document.getElementById('locInput').value;
        try {
            const res = await fetch(`${gasUrl}?place=${encodeURIComponent(loc)}`);
            const data = await res.json();
            
            document.getElementById('scoreVal').innerText = data.score;
            document.getElementById('scoreVal').style.color = data.score >= 70 ? 'var(--danger)' : (data.score >= 40 ? 'var(--warning)' : 'var(--accent)');
            
            document.getElementById('recText').innerText = data.recommendation;
            document.getElementById('recArea').style.display = 'block';

            if (data.pastInsights && data.pastInsights.length > 0) {
                document.getElementById('insightList').innerHTML = data.pastInsights.map(i => `
                    <div class="insight-item">
                        <span class="badge ${i.importance >= 4 ? 'badge-5' : ''}">é‡è¦åº¦ ${i.importance}</span>
                        <span style="font-size:0.7rem; color:#8899a6; float:right;">${i.date}</span><br>
                        <strong>${i.topic}</strong><br>
                        <div style="color:#cbd5e1; margin-top:5px;">${i.content}</div>
                    </div>
                `).join('');
                document.getElementById('insightCard').style.display = 'block';
            } else {
                document.getElementById('insightCard').style.display = 'none';
            }
        } catch(e) { alert("è§£æã«å¤±æ•—ã—ã¾ã—ãŸã€‚URLã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚"); }
        document.getElementById('loader').style.display = 'none';
    }
</script>
</body>
</html>
