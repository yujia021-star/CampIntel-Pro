<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CampGuard AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; background: #0a0c10; color: #fff; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { width: 100%; max-width: 400px; }
        .card { background: #161b22; border-radius: 20px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        h1 { font-family: 'Bebas Neue'; font-size: 2.5rem; color: #58a6ff; margin: 0; text-align: center; }
        input { width: 100%; padding: 12px; margin: 10px 0; background: #0d1117; border: 1px solid #30363d; border-radius: 8px; color: #fff; }
        button { width: 100%; padding: 15px; background: #58a6ff; border: none; border-radius: 8px; color: #000; font-weight: bold; cursor: pointer; }
        #resultArea { display: none; text-align: center; }
        .score-num { font-family: 'Bebas Neue'; font-size: 4rem; color: #fff; margin: 10px 0; }
        .timeline { display: flex; overflow-x: auto; gap: 10px; padding: 10px 0; }
        .t-item { min-width: 60px; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 10px; font-size: 0.8rem; }
        .insight-box { background: rgba(88,166,255,0.1); padding: 10px; border-radius: 8px; margin-top: 10px; text-align: left; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="container">
    <div id="loginArea" class="card">
        <h1>CAMPGUARD AI</h1>
        <input type="text" id="uid" placeholder="USER ID">
        <input type="password" id="pwd" placeholder="PASSWORD">
        <button onclick="login()">LOGIN</button>
    </div>

    <div id="mainArea" style="display:none;">
        <div class="card">
            <input type="text" id="loc" placeholder="„Ç≠„É£„É≥„ÉóÂ†¥Âêç" value="Â∞èÂÄâÊ©ã">
            <button onclick="diagnose()">Ë®∫Êñ≠ÈñãÂßã</button>
        </div>

        <div id="resultArea" class="card">
            <h2 id="resLoc" style="margin:0;">---</h2>
            <div class="score-num" id="resScore">0</div>
            <p id="resReason" style="color:#58a6ff; font-weight:bold;"></p>
            <div class="timeline" id="resTimeline"></div>
            <div id="insightContainer"></div>
        </div>

        <div class="card">
            <input type="text" id="diaryContent" placeholder="Áä∂Ê≥Å„ÇíÂ†±ÂëäÔºàÂú∞Èù¢„ÄÅÊ∑∑Èõë„Å™„Å©Ôºâ">
            <button style="background:#30363d; color:#fff;" onclick="postDiary()">Áü•ÊÅµ„ÇíÂÖ±Êúâ„Åô„Çã</button>
        </div>
    </div>
</div>

<script>
    const gasUrl = "https://script.google.com/macros/s/AKfycbyqDTFt6HyyWfDLJJTkB2hQfSik9oJJfmIJBsRZ4U_kacbxYjlE2lB759s7scGMhaHx/exec";
    let currentUser = "";

    async function login() {
        const res = await fetch(`${gasUrl}?mode=login&uid=${document.getElementById('uid').value}&pwd=${document.getElementById('pwd').value}`);
        if(await res.text() === "success") {
            currentUser = document.getElementById('uid').value;
            document.getElementById('loginArea').style.display = 'none';
            document.getElementById('mainArea').style.display = 'block';
        } else { alert("„É≠„Ç∞„Ç§„É≥Â§±Êïó"); }
    }

    async function diagnose() {
        const res = await fetch(`${gasUrl}?mode=diagnose&place=${encodeURIComponent(document.getElementById('loc').value)}`);
        const data = await res.json();
        document.getElementById('resultArea').style.display = 'block';
        document.getElementById('resLoc').innerText = data.locationName;
        document.getElementById('resScore').innerText = data.score;
        document.getElementById('resReason').innerText = data.scoreReason;
        
        document.getElementById('resTimeline').innerHTML = data.timeline.map(t => `
            <div class="t-item">
                ${t.time}<br>
                <img src="https://openweathermap.org/img/wn/${t.icon}.png" width="30"><br>
                ${t.temp}‚ÑÉ
            </div>
        `).join('');
        
        document.getElementById('insightContainer').innerHTML = data.localInsights.map(i => `
            <div class="insight-box">üìî ${i.content}</div>
        `).join('');
    }

    async function postDiary() {
        const content = document.getElementById('diaryContent').value;
        const loc = document.getElementById('loc').value;
        if(!content) return;
        await fetch(`${gasUrl}?mode=postDiary&uid=${currentUser}&place=${encodeURIComponent(loc)}&content=${encodeURIComponent(content)}`);
        alert("ÊäïÁ®ø„Åó„Åæ„Åó„Åü");
        document.getElementById('diaryContent').value = "";
    }
</script>
</body>
</html>
