<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CampGuard Expert Ver 10.0</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        :root { --bg: #0b0f1a; --card: rgba(30, 41, 59, 0.9); --accent: #38bdf8; --text: #f1f5f9; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 80px; }
        .container { max-width: 480px; margin: 0 auto; padding: 15px; }
        
        /* ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ */
        .tab-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #1e293b; display: flex; justify-content: space-around; padding: 15px; border-top: 1px solid rgba(255,255,255,0.1); z-index: 1000; }
        .tab-item { color: #94a3b8; font-size: 0.75rem; text-decoration: none; cursor: pointer; text-align: center; }
        .tab-item.active { color: var(--accent); font-weight: bold; }

        .page { display: none; }
        .page.active { display: block; }

        /* ãƒ¡ã‚¤ãƒ³ã‚«ãƒ¼ãƒ‰é¡ã¯Ver 9.2ã‚’ç¶™æ‰¿ */
        .main-card { background: var(--card); border-radius: 28px; padding: 20px; border: 1px solid rgba(255,255,255,0.1); text-align: center; margin-bottom: 15px; }
        
        /* æ—¥è¨˜å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  */
        .diary-form input, .diary-form textarea { width: 100%; padding: 12px; margin-bottom: 10px; border-radius: 12px; background: #1a2236; border: 1px solid #334155; color: white; box-sizing: border-box; }
        .btn-post { background: var(--accent); color: #0b0f1a; border: none; padding: 15px; width: 100%; border-radius: 12px; font-weight: bold; }

        /* ãƒªã‚¹ãƒˆè¡¨ç¤º */
        .diary-item { background: var(--card); border-radius: 16px; padding: 15px; margin-bottom: 10px; border: 1px solid rgba(255,255,255,0.05); }
    </style>
</head>
<body>

<div class="container">
    <div id="diagnosePage" class="page active">
        <h2 style="text-align:center;">CampGuard <span style="color:var(--accent)">Expert</span></h2>
        <div class="search-row" style="display:flex; gap:8px; margin-bottom:15px;">
            <input type="text" id="locInput" value="å–œå¤šæ–¹å¸‚" style="flex:1; padding:12px; border-radius:12px; border:1px solid #334155; background:var(--card); color:white;">
            <button onclick="diagnose()" style="background:var(--accent); border:none; border-radius:12px; padding:0 15px; font-weight:bold;">è¨ºæ–­</button>
        </div>
        <div id="resultArea">è¨ºæ–­çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™</div>
    </div>

    <div id="postPage" class="page">
        <h2 style="text-align:center;">Camp <span style="color:var(--accent)">Diary</span></h2>
        <div class="main-card diary-form">
            <input type="text" id="diaryPlace" placeholder="ã‚­ãƒ£ãƒ³ãƒ—å ´å">
            <input type="text" id="diaryTopic" placeholder="ãƒˆãƒ”ãƒƒã‚¯ï¼ˆä¾‹ï¼šã‚µã‚¤ãƒˆã®é¢¨ï¼‰">
            <textarea id="diaryContent" rows="4" placeholder="å†…å®¹ï¼ˆä¾‹ï¼šã‚µã‚¤ãƒˆAã¯åŒ—é¢¨ãŒé˜²ã’ã‚‹ï¼‰"></textarea>
            <select id="diaryCategory" style="width:100%; padding:12px; border-radius:12px; background:#1a2236; border:1px solid #334155; color:white; margin-bottom:10px;">
                <option value="ã‚µã‚¤ãƒˆæƒ…å ±">ã‚µã‚¤ãƒˆæƒ…å ±</option>
                <option value="è™«ãƒ»å‹•ç‰©">è™«ãƒ»å‹•ç‰©</option>
                <option value="è¨­å‚™ãƒ»å‘¨è¾º">è¨­å‚™ãƒ»å‘¨è¾º</option>
                <option value="ãã®ä»–">ãã®ä»–</option>
            </select>
            <button class="btn-post" onclick="submitDiary()">æ—¥è¨˜ã‚’æŠ•ç¨¿ã™ã‚‹</button>
        </div>
    </div>

    <div id="listPage" class="page">
        <h2 style="text-align:center;">Past <span style="color:var(--accent)">Records</span></h2>
        <div id="diaryList"></div>
    </div>
</div>

<div class="tab-bar">
    <div class="tab-item active" onclick="showPage('diagnosePage')">ğŸ <br>è¨ºæ–­</div>
    <div class="tab-item" onclick="showPage('postPage')">âœï¸<br>æ—¥è¨˜ã‚’æ›¸ã</div>
    <div class="tab-item" onclick="loadDiaries()">ğŸ“š<br>å±¥æ­´</div>
</div>

<script>
    const gasUrl = "â˜…ã‚ãªãŸã®ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªURLâ˜…";

    function showPage(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
        // ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã«è‰²ã‚’ã¤ã‘ã‚‹å‡¦ç†
    }

    async function submitDiary() {
        const place = document.getElementById('diaryPlace').value;
        const topic = document.getElementById('diaryTopic').value;
        const content = document.getElementById('diaryContent').value;
        const category = document.getElementById('diaryCategory').value;

        const url = `${gasUrl}?mode=postDiary&place=${encodeURIComponent(place)}&topic=${encodeURIComponent(topic)}&content=${encodeURIComponent(content)}&category=${encodeURIComponent(category)}`;
        
        await fetch(url);
        alert("æ—¥è¨˜ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼ã“ã®æƒ…å ±ã¯æ¬¡å›ã®è¨ºæ–­ã«åæ˜ ã•ã‚Œã¾ã™ã€‚");
        showPage('diagnosePage');
    }

    async function loadDiaries() {
        showPage('listPage');
        const res = await fetch(`${gasUrl}?mode=getDiaries`);
        const data = await res.json();
        const list = document.getElementById('diaryList');
        list.innerHTML = data.map(d => `
            <div class="diary-item">
                <div style="font-size:0.7rem; color:var(--accent);">${new Date(d.date).toLocaleDateString()} @${d.place}</div>
                <div style="font-weight:bold; margin:5px 0;">${d.topic}</div>
                <div style="font-size:0.85rem; color:#cbd5e1;">${d.content}</div>
            </div>
        `).join('');
    }
    
    // diagnose() é–¢æ•°ãªã©ã¯Ver 9.2ã®ã‚‚ã®ã‚’æµç”¨
</script>
</body>
</html>
