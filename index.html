<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CampGuard Pro AI</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        :root {
            --bg: #0f172a; /* 深い夜空の色 */
            --card: rgba(30, 41, 59, 0.7);
            --accent: #38bdf8;
            --danger: #ef4444;
            --text: #f1f5f9;
        }
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            background-attachment: fixed;
            color: var(--text);
            margin: 0;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }
        .container { width: 100%; max-width: 450px; padding: 25px; box-sizing: border-box; }
        .header h1 { font-size: 1.8rem; margin-bottom: 5px; background: linear-gradient(to right, #38bdf8, #818cf8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .search-box { position: relative; margin-bottom: 30px; }
        input { width: 100%; padding: 15px; border-radius: 12px; border: 1px solid #334155; background: var(--card); color: white; backdrop-filter: blur(10px); box-sizing: border-box; font-size: 1rem; }
        button { position: absolute; right: 8px; top: 8px; padding: 8px 20px; border-radius: 8px; border: none; background: var(--accent); color: #0f172a; font-weight: bold; cursor: pointer; transition: 0.3s; }
        button:hover { opacity: 0.8; transform: scale(0.95); }

        .gauge-container { 
            background: var(--card); border-radius: 24px; padding: 30px 20px; text-align: center; 
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.5); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 25px; position: relative;
        }
        .chart-box { height: 200px; width: 100%; }
        .score-label { position: absolute; bottom: 45px; left: 50%; transform: translateX(-50%); }
        .score-number { font-size: 4rem; font-weight: 800; line-height: 1; color: var(--text); }
        .location-tag { font-size: 0.9rem; color: var(--accent); margin-top: 10px; display: block; font-weight: bold; }

        .result-card { background: var(--card); border-radius: 24px; padding: 25px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.1); display: none; }
        .badge { padding: 5px 15px; border-radius: 50px; font-size: 0.75rem; font-weight: bold; margin-bottom: 15px; display: inline-block; }
        .danger { background: var(--danger); }
        .safe { background: #10b981; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>CampGuard Pro</h1>
        <p style="color: #94a3b8; font-size: 0.85rem;">Smart Risk Analytics</p>
    </div>

    <div class="search-box">
        <input type="text" id="locationInput" placeholder="地名を入力（例：道志村）" value="小倉橋">
        <button onclick="diagnose()">診断</button>
    </div>

    <div class="gauge-container">
        <div class="chart-box"><canvas id="gaugeChart"></canvas></div>
        <div class="score-label">
            <span id="scoreValue" class="score-number">--</span>
            <span id="targetName" class="location-tag">Waiting...</span>
        </div>
    </div>

    <div id="resultArea" class="result-card">
        <div id="statusBadge" class="badge">ANALYSIS</div>
        <div id="message" style="font-size: 1.1rem; font-weight: 500;"></div>
        <div id="details" style="color: #94a3b8; font-size: 0.85rem; margin-top: 10px;"></div>
    </div>
</div>

<script>
    let myChart;
    const gasUrl = "あなたのGASのURL"; // ★ここに自分のURLを貼る

    function initChart() {
        const ctx = document.getElementById('gaugeChart').getContext('2d');
        myChart = new Chart(ctx, {
            type: 'doughnut',
            data: {
                datasets: [{
                    data: [1, 1, 1],
                    backgroundColor: ['rgba(56, 189, 248, 0.1)', 'rgba(56, 189, 248, 0.1)', 'rgba(56, 189, 248, 0.1)'],
                    borderWidth: 0, circumference: 180, rotation: 270,
                }]
            },
            options: { responsive: true, maintainAspectRatio: false, cutout: '88%', plugins: { legend: { display: false } } }
        });
    }

    async function diagnose() {
        const loc = document.getElementById('locationInput').value;
        const scoreDisp = document.getElementById('scoreValue');
        document.getElementById('targetName').innerText = "Searching...";
        
        try {
            const res = await fetch(`${gasUrl}?place=${encodeURIComponent(loc)}`);
            const data = await res.json();
            
            scoreDisp.innerText = data.score;
            document.getElementById('targetName').innerText = data.locationName;
            updateGauge(data.score);
            
            document.getElementById('resultArea').style.display = 'block';
            document.getElementById('statusBadge').className = data.score >= 50 ? "badge danger" : "badge safe";
            document.getElementById('statusBadge').innerText = data.score >= 50 ? "HIGH RISK" : "STABLE";
            document.getElementById('message').innerText = data.advice;
            document.getElementById('details').innerText = `Wind: ${data.windSpeed}m/s | Local Alerts: ${data.snsReports}`;
        } catch (e) { scoreDisp.innerText = "ERR"; }
    }

    function updateGauge(s) {
        const colors = myChart.data.datasets[0].backgroundColor;
        colors.fill('rgba(56, 189, 248, 0.1)');
        if (s < 40) colors[0] = '#10b981';
        else if (s < 70) colors[1] = '#f59e0b';
        else colors[2] = '#ef4444';
        myChart.update();
    }
    window.onload = initChart;
</script>
</body>
</html>